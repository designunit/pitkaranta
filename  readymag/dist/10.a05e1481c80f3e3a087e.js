(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{RnhZ:function(e,t,n){var r={"./af":"K/tc","./af.js":"K/tc","./ar":"jnO4","./ar-dz":"o1bE","./ar-dz.js":"o1bE","./ar-kw":"Qj4J","./ar-kw.js":"Qj4J","./ar-ly":"HP3h","./ar-ly.js":"HP3h","./ar-ma":"CoRJ","./ar-ma.js":"CoRJ","./ar-sa":"gjCT","./ar-sa.js":"gjCT","./ar-tn":"bYM6","./ar-tn.js":"bYM6","./ar.js":"jnO4","./az":"SFxW","./az.js":"SFxW","./be":"H8ED","./be.js":"H8ED","./bg":"hKrs","./bg.js":"hKrs","./bm":"p/rL","./bm.js":"p/rL","./bn":"kEOa","./bn.js":"kEOa","./bo":"0mo+","./bo.js":"0mo+","./br":"aIdf","./br.js":"aIdf","./bs":"JVSJ","./bs.js":"JVSJ","./ca":"1xZ4","./ca.js":"1xZ4","./cs":"PA2r","./cs.js":"PA2r","./cv":"A+xa","./cv.js":"A+xa","./cy":"l5ep","./cy.js":"l5ep","./da":"DxQv","./da.js":"DxQv","./de":"tGlX","./de-at":"s+uk","./de-at.js":"s+uk","./de-ch":"u3GI","./de-ch.js":"u3GI","./de.js":"tGlX","./dv":"WYrj","./dv.js":"WYrj","./el":"jUeY","./el.js":"jUeY","./en-SG":"zavE","./en-SG.js":"zavE","./en-au":"Dmvi","./en-au.js":"Dmvi","./en-ca":"OIYi","./en-ca.js":"OIYi","./en-gb":"Oaa7","./en-gb.js":"Oaa7","./en-ie":"4dOw","./en-ie.js":"4dOw","./en-il":"czMo","./en-il.js":"czMo","./en-nz":"b1Dy","./en-nz.js":"b1Dy","./eo":"Zduo","./eo.js":"Zduo","./es":"iYuL","./es-do":"CjzT","./es-do.js":"CjzT","./es-us":"Vclq","./es-us.js":"Vclq","./es.js":"iYuL","./et":"7BjC","./et.js":"7BjC","./eu":"D/JM","./eu.js":"D/JM","./fa":"jfSC","./fa.js":"jfSC","./fi":"gekB","./fi.js":"gekB","./fo":"ByF4","./fo.js":"ByF4","./fr":"nyYc","./fr-ca":"2fjn","./fr-ca.js":"2fjn","./fr-ch":"Dkky","./fr-ch.js":"Dkky","./fr.js":"nyYc","./fy":"cRix","./fy.js":"cRix","./ga":"USCx","./ga.js":"USCx","./gd":"9rRi","./gd.js":"9rRi","./gl":"iEDd","./gl.js":"iEDd","./gom-latn":"DKr+","./gom-latn.js":"DKr+","./gu":"4MV3","./gu.js":"4MV3","./he":"x6pH","./he.js":"x6pH","./hi":"3E1r","./hi.js":"3E1r","./hr":"S6ln","./hr.js":"S6ln","./hu":"WxRl","./hu.js":"WxRl","./hy-am":"1rYy","./hy-am.js":"1rYy","./id":"UDhR","./id.js":"UDhR","./is":"BVg3","./is.js":"BVg3","./it":"bpih","./it-ch":"bxKX","./it-ch.js":"bxKX","./it.js":"bpih","./ja":"B55N","./ja.js":"B55N","./jv":"tUCv","./jv.js":"tUCv","./ka":"IBtZ","./ka.js":"IBtZ","./kk":"bXm7","./kk.js":"bXm7","./km":"6B0Y","./km.js":"6B0Y","./kn":"PpIw","./kn.js":"PpIw","./ko":"Ivi+","./ko.js":"Ivi+","./ku":"JCF/","./ku.js":"JCF/","./ky":"lgnt","./ky.js":"lgnt","./lb":"RAwQ","./lb.js":"RAwQ","./lo":"sp3z","./lo.js":"sp3z","./lt":"JvlW","./lt.js":"JvlW","./lv":"uXwI","./lv.js":"uXwI","./me":"KTz0","./me.js":"KTz0","./mi":"aIsn","./mi.js":"aIsn","./mk":"aQkU","./mk.js":"aQkU","./ml":"AvvY","./ml.js":"AvvY","./mn":"lYtQ","./mn.js":"lYtQ","./mr":"Ob0Z","./mr.js":"Ob0Z","./ms":"6+QB","./ms-my":"ZAMP","./ms-my.js":"ZAMP","./ms.js":"6+QB","./mt":"G0Uy","./mt.js":"G0Uy","./my":"honF","./my.js":"honF","./nb":"bOMt","./nb.js":"bOMt","./ne":"OjkT","./ne.js":"OjkT","./nl":"+s0g","./nl-be":"2ykv","./nl-be.js":"2ykv","./nl.js":"+s0g","./nn":"uEye","./nn.js":"uEye","./pa-in":"8/+R","./pa-in.js":"8/+R","./pl":"jVdC","./pl.js":"jVdC","./pt":"8mBD","./pt-br":"0tRk","./pt-br.js":"0tRk","./pt.js":"8mBD","./ro":"lyxo","./ro.js":"lyxo","./ru":"lXzo","./ru.js":"lXzo","./sd":"Z4QM","./sd.js":"Z4QM","./se":"//9w","./se.js":"//9w","./si":"7aV9","./si.js":"7aV9","./sk":"e+ae","./sk.js":"e+ae","./sl":"gVVK","./sl.js":"gVVK","./sq":"yPMs","./sq.js":"yPMs","./sr":"zx6S","./sr-cyrl":"E+lV","./sr-cyrl.js":"E+lV","./sr.js":"zx6S","./ss":"Ur1D","./ss.js":"Ur1D","./sv":"X709","./sv.js":"X709","./sw":"dNwA","./sw.js":"dNwA","./ta":"PeUW","./ta.js":"PeUW","./te":"XLvN","./te.js":"XLvN","./tet":"V2x9","./tet.js":"V2x9","./tg":"Oxv6","./tg.js":"Oxv6","./th":"EOgW","./th.js":"EOgW","./tl-ph":"Dzi0","./tl-ph.js":"Dzi0","./tlh":"z3Vd","./tlh.js":"z3Vd","./tr":"DoHr","./tr.js":"DoHr","./tzl":"z1FC","./tzl.js":"z1FC","./tzm":"wQk9","./tzm-latn":"tT3J","./tzm-latn.js":"tT3J","./tzm.js":"wQk9","./ug-cn":"YRex","./ug-cn.js":"YRex","./uk":"raLr","./uk.js":"raLr","./ur":"UpQW","./ur.js":"UpQW","./uz":"Loxo","./uz-latn":"AQ68","./uz-latn.js":"AQ68","./uz.js":"Loxo","./vi":"KSF8","./vi.js":"KSF8","./x-pseudo":"/X5v","./x-pseudo.js":"/X5v","./yo":"fzPg","./yo.js":"fzPg","./zh-cn":"XDpg","./zh-cn.js":"XDpg","./zh-hk":"SatO","./zh-hk.js":"SatO","./zh-tw":"kOpN","./zh-tw.js":"kOpN"};function a(e){var t=o(e);return n(t)}function o(e){if(!n.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}a.keys=function(){return Object.keys(r)},a.resolve=o,e.exports=a,a.id="RnhZ"},b1Nn:function(e,t,n){"use strict";n.r(t);var r,a=n("q1tI"),o=n.n(a),i=n("i8i4"),s=n.n(i),c=n("iC7s");function l(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var n=[],r=!0,a=!1,o=void 0;try{for(var i,s=e[Symbol.iterator]();!(r=(i=s.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){a=!0,o=e}finally{try{r||null==s.return||s.return()}finally{if(a)throw o}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function u(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function d(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?u(n,!0).forEach((function(t){p(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):u(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function p(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}!function(e){e.ToggleSettingsSidebar="toggleSettingsSidebar",e.ToggleTrash="toggleTrash",e.TogglePageSettings="togglePageSettings",e.OpenSettingsForPage="openSettingsForPage",e.ClosePageSettings="closePageSettings",e.SetCurrentPageNum="setCurrentPageNum",e.TogglePageSelection="togglePageSelection",e.SetDragging="setDragging"}(r||(r={}));var g=o.a.createContext({}),f=function(e){var t=e.magModel,n=e.router,i=e.children,s={isSettingsOpened:!1,isTrashOpened:!1,isPageSettingsOpened:!1,currentPageNum:n.workspace.getPageNum(),selectedPages:{},isDragging:!1},c=function(e,t){var n=d({},e.selectedPages);return n[t]?delete n[t]:n[t]=!0,n},u=l(Object(a.useReducer)((function(e,t){switch(t.type){case r.ToggleSettingsSidebar:return d({},e,{isSettingsOpened:!e.isSettingsOpened});case r.ToggleTrash:return d({},e,{isTrashOpened:!e.isTrashOpened});case r.TogglePageSettings:return d({},e,{isPageSettingsOpened:!e.isPageSettingsOpened});case r.SetCurrentPageNum:return d({},e,{currentPageNum:t.payload});case r.TogglePageSelection:return d({},e,{selectedPages:c(e,t.payload)});case r.SetDragging:return d({},e,{isDragging:t.payload});default:return e}}),s),2),p=u[0],f=u[1];return o.a.createElement(g.Provider,{value:d({},p,{dispatch:f,setPageVisibility:function(e,n){return new Promise((function(r,a){var o=t.getPage(e);o||r(),o.save({hidden:n}).done((function(e){r(e)})).fail((function(e){a(e.responseJSON)}))}))},validatePageUri:function(e,n){var r=t.getPage(e);return r?r.validate({uri:n}):{pageNotFound:!0}}})},i)},m=function(e,t,n,r){var a=n.findIndex((function(t){return t.num===e})),o=a>=0?n[a]:null,i=e+1;if(o&&o.children&&o.children.length&&r[o._id]&&!r[o._id].collapsed){var s=n[a+1];i=s?s.num:o.children[o.children.length-1].num+1}var c=null;if(o&&o.children&&o.children.length&&r[o._id]&&r[o._id].collapsed)c=o._id;else if(!o){var l=t.find((function(t){return t.num===e}));l&&(c=l.parentPage)}return{newPageNum:i,newPageParentId:c}},h=n("za5s"),b=n("vOnD"),y=b.d.button.withConfig({displayName:"question-button__StyledButton"})(["padding:0;background:transparent;border:0;border-image:none;outline:none;cursor:pointer;"]),v=function(e){var t=e.onClick;return o.a.createElement(y,{onClick:t},o.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"6px",height:"10px",viewBox:"0 0 6 10"},o.a.createElement("g",{stroke:"none",strokeWidth:"1",fill:"none",fillRule:"evenodd"},o.a.createElement("g",{transform:"translate(-994.000000, -39.000000)",fill:"#808080",fillRule:"nonzero"},o.a.createElement("path",{d:"M994.197187,41.8300781 C994.224531,41.1308559 994.46867,40.5634787 994.929609,40.1279297 C995.390549,39.6923806 996.033121,39.4746094 996.857344,39.4746094 C997.626879,39.4746094 998.250896,39.6796854 998.729414,40.0898438 C999.207932,40.5000021 999.447187,41.0253874 999.447187,41.6660156 C999.447187,42.5097698 999.037035,43.1777319 998.216719,43.6699219 C997.841717,43.8925792 997.58586,44.0986319 997.449141,44.2880859 C997.312421,44.47754 997.244062,44.7207016 997.244062,45.0175781 L997.244062,45.3691406 L996.031172,45.3691406 L996.025312,44.9238281 C996.009687,44.5097636 996.091718,44.1591811 996.271406,43.8720703 C996.451095,43.5849595 996.746014,43.3183606 997.156172,43.0722656 C997.515549,42.8574208 997.765546,42.6513682 997.906172,42.4541016 C998.046798,42.256835 998.117109,42.0117202 998.117109,41.71875 C998.117109,41.3945296 997.996017,41.1279307 997.753828,40.9189453 C997.511639,40.7099599 997.19133,40.6054688 996.792891,40.6054688 C996.390545,40.6054688 996.066329,40.7158192 995.820234,40.9365234 C995.574139,41.1572277 995.437422,41.4550762 995.410078,41.8300781 L994.197187,41.8300781 Z M997.36125,47.8886719 C997.197187,48.0527352 996.980392,48.1347656 996.710859,48.1347656 C996.441327,48.1347656 996.222579,48.0527352 996.054609,47.8886719 C995.88664,47.7246086 995.802656,47.509767 995.802656,47.2441406 C995.802656,46.974608 995.88664,46.7568368 996.054609,46.5908203 C996.222579,46.4248039 996.441327,46.3417969 996.710859,46.3417969 C996.980392,46.3417969 997.198163,46.4238273 997.36418,46.5878906 C997.530196,46.7519539 997.613203,46.9707018 997.613203,47.2441406 C997.613203,47.509767 997.52922,47.7246086 997.36125,47.8886719 Z"})))))};function j(){var e=function(e,t){t||(t=e.slice(0));return Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}(["\n  display: block;\n  ",";\n"]);return j=function(){return e},e}function w(){return(w=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}var O,S=o.a.createElement("path",{d:"M11.738 1a5 5 0 00-4.35 2.5l-5.149 8.918a5 5 0 00.01 5.017l5.267 9.04a5 5 0 004.301 2.484L22.28 29a5 5 0 004.35-2.5l5.149-8.918a5 5 0 00-.01-5.017l-5.267-9.04A5 5 0 0022.2 1.04l-10.463-.04zm5.273 7.987a6.013 6.013 0 110 12.026 6.013 6.013 0 010-12.026z",stroke:"#FFF",strokeWidth:2,fill:"none",fillRule:"evenodd"}),x=Object(b.d)((function(e){return o.a.createElement("svg",w({width:34,height:30},e),S)}))(j(),h.color),P=b.d.a.withConfig({displayName:"SettingsHead___StyledA"})([".user-avatar-settings-sidebar{width:56px;height:56px;}"]),E=function(e){var t=e.projectSettingsPanel,n=Object(a.useContext)(dn);return o.a.createElement(c.i,{p:2,mb:"3px"},o.a.createElement(c.r,{alignItems:"center",justifyContent:"flex-start",position:"relative"},o.a.createElement(c.i,{width:"56px",height:"56px",mr:2,bg:"darkGray",borderRadius:"round"},o.a.createElement(P,{href:"/".concat(n.project.user.uri)},o.a.createElement(c.I,{url:n.project.user.pic,name:n.project.user.name,className:"user-avatar-settings-sidebar"}))),o.a.createElement(c.J,{size:56,color:"darkGray",onClick:function(){return t.toggle()}},o.a.createElement(x,null)),o.a.createElement(c.i,{position:"absolute",right:8,mt:"-1px"},o.a.createElement(v,{onClick:function(){}}))))},_=n("wd/R"),C=n.n(_),k=n("xG9w"),T=n("wEEd"),N=n("y4v0"),I=4e3,A=124,D=112,B=56,R=192,z=172,M=88;!function(e){e.Duplicate="duplicate",e.Delete="detele",e.Settings="settings"}(O||(O={}));var L=function(){return isNaN(window.RM.shadowBlockAnimSpeed)?.1:window.RM.shadowBlockAnimSpeed},F=Object(b.d)(c.i).withConfig({displayName:"PageActionsPopup___StyledBox"})(["transform:translateX(",");transition:0.3s transform ease;"],(function(e){return e._css})),G=Object(b.d)(c.i).withConfig({displayName:"PageActionsPopup___StyledBox2"})(["background-color:rgba(40,40,40,0.92);"]),W=Object(a.forwardRef)((function(e,t){var n=e.isShown,r=e.isPageSettingsOpened,a=e.coords,i=e.callback;return n?s.a.createPortal(o.a.createElement(F,{ref:t,position:"absolute",left:a.x-160,top:a.y-80,zIndex:8e3,_css:r?"-240px":"0px"},o.a.createElement(G,{width:148,height:124,borderRadius:"l",bg:"black",pl:3,pt:12},o.a.createElement(c.i,null,o.a.createElement(c.j,{textStyle:"subheading",color:"white",onClick:function(e){return i(O.Duplicate,e)}},"Duplicate")),o.a.createElement(c.i,{mt:12},o.a.createElement(c.j,{textStyle:"subheading",color:r?"tomato":"white",onClick:function(e){return i(O.Settings,e)}},"Settings")),o.a.createElement(c.i,{mt:12},o.a.createElement(c.j,{textStyle:"subheading",color:"white",onClick:function(e){return i(O.Delete,e)}},"Delete"))),o.a.createElement(c.r,{position:"absolute",top:68,right:-8},o.a.createElement(c.Y,{color:"black"}))),document.body):null}));W.displayName="PageActionsPopup";var U=W,Y=n("OTSC"),V=Object(b.d)(c.F).withConfig({displayName:"PageScreenshot___StyledPicture"})(["border-radius:4px;opacity:",";filter:blur(",");"],(function(e){return e._css}),(function(e){return e._css2})),X=function(e){var t=e.url,n=e.opacity,r=e.blur,a=void 0!==r&&r;if(!t)return null;var i=t,s=t.split("."),l=s[s.length-2].split("_");if(l.length<=1||isNaN(+l[l.length-1])){var u=Y.default.screenshotSize(256);i=Y.default.addFilenameComponent(t,u)}return o.a.createElement(c.i,{width:"100%",height:"100%",position:"relative"},o.a.createElement(V,{width:"100%",height:"100%",src:i,_css:void 0!==n?n:1,_css2:a?"1px":0}),o.a.createElement(c.i,{width:"100%",height:"100%",position:"absolute",top:0,left:0}))};function J(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var n=[],r=!0,a=!1,o=void 0;try{for(var i,s=e[Symbol.iterator]();!(r=(i=s.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){a=!0,o=e}finally{try{r||null==s.return||s.return()}finally{if(a)throw o}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var H=Object(b.d)(c.i).withConfig({displayName:"PageListItem___StyledBox"})(["user-select:",";"],(function(e){return e._css})),Q=Object(b.d)(c.r).withConfig({displayName:"PageListItem___StyledFlex"})(["cursor:pointer;z-index:1;transform:rotate(",") translateX(",");transition:transform 200ms ease;"],(function(e){return e._css2}),(function(e){return e._css3})),Z=Object(b.d)(c.i).withConfig({displayName:"PageListItem___StyledBox2"})(["box-shadow:",";cursor:pointer;:hover{.page-actions-popup{opacity:",";display:",";}.page-actions-button{opacity:",";display:",";}}transform-origin:left;transform:scale(",");"],(function(e){return e._css4}),(function(e){return e._css5}),(function(e){return e._css6}),(function(e){return e._css7}),(function(e){return e._css8}),(function(e){return e._css9})),q=o.a.memo((function(e){var t=e.page,n=e.gridSize,i=e.level,s=void 0===i?0:i,l=e.head,u=e.isCmdPressed,d=e.onCollapsed,p=e.isPageCollapsed,f=void 0===p||p,m=Object(a.useContext)(dn),h=Object(a.useContext)(g),b=s?16*s:s,y=J(Object(a.useState)(t.num===m.currentPageNum),2),v=y[0],j=y[1];Object(a.useEffect)((function(){j(t.num===m.currentPageNum)}),[m.currentPageNum]);return o.a.createElement(H,{width:"192px",my:"6px",ml:"".concat(b,"px"),position:"relative",display:n===me.Standard?"block":"flex",_css:h.isDragging?"none":"auto"},v&&o.a.createElement(c.i,{width:"6px",height:"6px",borderRadius:"round",bg:"tomato",position:"absolute",top:n===me.Standard?60:"25px",left:"-15px",zIndex:1}),l?o.a.createElement(Q,{width:12,height:12,position:"absolute",top:n===me.Standard?134:14,left:n===me.Standard?-3:93,alignItems:"center",justifyContent:"center",onClick:function(){d&&d()},_css2:f?"0deg":"-90deg",_css3:f?me.Standard?"3px":"2px":"0px"},o.a.createElement(c.ab,{color:"black"})):null,o.a.createElement(Z,{width:n===me.Standard?192:"88px",height:n===me.Standard?124:"56px",className:"page-list-item-picture",mb:s?1:"0px",bg:"white",borderRadius:"s",position:"relative",zIndex:1,"data-page-id":t._id,onClick:function(e){e.preventDefault();var t=e.currentTarget.dataset.pageId;t&&(u?h.dispatch({type:r.TogglePageSelection,payload:t}):(j(!0),window.RM.constructorRouter.showWorkspace({id:t})))},_css4:h.selectedPages[t._id]?"0 0 0 4px #f4f4f4, 0 0 0 8px #ec520b":"0 1px 1px rgba(64, 64, 64, 0.32)",_css5:!v&&h.isPageSettingsOpened?0:1,_css6:!v&&h.isPageSettingsOpened?"none":"flex",_css7:!v&&h.isPageSettingsOpened?0:1,_css8:!v&&h.isPageSettingsOpened?"none":"block",_css9:s&&n===me.Standard?"0.9":"1"},o.a.createElement(X,{url:t.screenshot,opacity:t.hidden?.4:1}),o.a.createElement(K,{isCurrentPage:v,pageId:t._id,isPageHidden:t.hidden,gridSize:n,hidden:!!h.isDragging})),o.a.createElement(c.i,null,o.a.createElement(c.i,{width:"100%",ml:"".concat(n===me.Standard?l?16:0:l?24:8,"px"),mt:"".concat(n===me.Standard?6:10,"px")},o.a.createElement(c.W,{textStyle:"small"},t.num,"."),o.a.createElement(c.W,{textStyle:"small",color:t.title?"black":"darkGray"},"Â ",t.title?t.title:"Page Title")),o.a.createElement(c.i,{width:"100%",ml:"".concat(n===me.Standard?l&&f?16:0:8,"px"),mt:"-2px"},o.a.createElement(c.W,{textStyle:"small",color:t.uri?"black":"darkGray"},t.uri?"/".concat(t.uri):"/custom url"))))}));q.displayName="PageListItem";var K=o.a.memo((function(e){var t=e.isCurrentPage,n=e.pageId,i=e.isPageHidden,s=e.gridSize,c=e.hidden,l=void 0!==c&&c,u=Object(a.useContext)(g),d=Object(a.useContext)(dn),p=function(e){e.preventDefault(),e.stopPropagation(),d.deletePage(n)},f=function(e){e.preventDefault(),e.stopPropagation(),d.duplicatePage(n).then((function(){})).catch((function(e){console.warn("page dublicate",e)}))},m=function(e){e.preventDefault(),e.stopPropagation(),u.isTrashOpened?(u.dispatch({type:r.ToggleTrash}),setTimeout((function(){u.dispatch({type:r.TogglePageSettings})}),300)):u.dispatch({type:r.TogglePageSettings})};return l?null:s===me.Standard?o.a.createElement(ne,{isCurrentPage:t,isPageHidden:i,isPageSettingsOpened:u.isPageSettingsOpened,onPageDuplicate:f,onPageSettingsToggle:m,onPageDelete:p}):o.a.createElement(ae,{isCurrentPage:t,isPageHidden:i,isPageSettingsOpened:u.isPageSettingsOpened,onPageDuplicate:f,onPageSettingsToggle:m,onPageDelete:p})}));K.displayName="PageActionsPanel";var $=Object(b.d)(c.r).withConfig({displayName:"PageListItem___StyledFlex2"})(["opacity:",";transition:opacity 200ms ease;"],(function(e){return e._css10})),ee=Object(b.d)(c.J).withConfig({displayName:"PageListItem___StyledRoundButton"})(["display:",";"],(function(e){return e._css11})),te=Object(b.d)(c.J).withConfig({displayName:"PageListItem___StyledRoundButton2"})(["display:",";"],(function(e){return e._css12})),ne=o.a.memo((function(e){var t=e.isCurrentPage,n=e.isPageSettingsOpened,r=e.onPageDuplicate,i=e.onPageSettingsToggle,s=e.onPageDelete,l=J(Object(a.useState)(!1),2),u=l[0],d=l[1],p=J(Object(a.useState)(!1),2),g=p[0],f=p[1],m=J(Object(a.useState)(!1),2),h=m[0],b=m[1],y=J(Object(a.useState)(!1),2),v=y[0],j=y[1],w=J(Object(a.useState)(!1),2),O=w[0],S=w[1],x=J(Object(a.useState)(!1),2),P=x[0],E=x[1];return o.a.createElement($,{className:"page-actions-popup",width:176,height:32,justifyContent:"space-between",position:"absolute",bottom:8,left:8,_css10:t?"1":"0"},o.a.createElement(c.i,null,o.a.createElement(ee,{size:32,color:"white",hoverColor:"white",activeColor:"tomato",outline:!0,disabled:n,onClick:r,onMouseEnter:function(){return d(!0)},onMouseLeave:function(){return d(!1)},onMouseDown:function(){return f(!0)},onMouseUp:function(){return f(!1)},_css11:n?"none":"flex"},o.a.createElement(c.o,{color:g?"white":u?"tomato":"black"}))),o.a.createElement(c.i,null,o.a.createElement(c.J,{size:32,color:"white",hoverColor:"white",activeColor:"tomato",outline:!0,"data-hovered":t&&n,onClick:i,onMouseEnter:function(){return b(!0)},onMouseLeave:function(){return b(!1)},onMouseDown:function(){return j(!0)},onMouseUp:function(){return j(!1)}},o.a.createElement(c.L,{color:v?"white":h?"tomato":"black"}))),o.a.createElement(c.i,null,o.a.createElement(te,{size:32,color:"white",hoverColor:"white",activeColor:"tomato",outline:!0,onClick:s,onMouseEnter:function(){return S(!0)},onMouseLeave:function(){return S(!1)},onMouseDown:function(){return E(!0)},onMouseUp:function(){return E(!1)},_css12:n?"none":"flex"},o.a.createElement(c.n,{color:P?"white":O?"tomato":"black"}))))}));ne.displayName="PageActionsStandartPanel";var re=Object(b.d)(c.i).withConfig({displayName:"PageListItem___StyledBox3"})(["opacity:",";transition:opacity 200ms ease;box-shadow:0 0 0 1px rgba(128,128,128,0.16);"],(function(e){return e._css13})),ae=o.a.memo((function(e){var t=e.isCurrentPage,n=e.isPageSettingsOpened,r=e.onPageDuplicate,i=e.onPageSettingsToggle,s=e.onPageDelete,l=J(Object(a.useState)(!1),2),u=l[0],d=l[1],p=J(Object(a.useState)(!1),2),g=p[0],f=p[1],m=J(Object(a.useState)(!1),2),h=m[0],b=m[1],y=J(Object(a.useState)({x:0,y:0}),2),v=y[0],j=y[1],w=Object(a.useRef)(null),S=function(e){e.preventDefault(),e.target&&w.current&&!w.current.contains(e.target)&&b(!1)};Object(a.useEffect)((function(){return h?window.addEventListener("click",S):window.removeEventListener("click",S),function(){window.removeEventListener("click",S)}}),[h]);return o.a.createElement(o.a.Fragment,null,o.a.createElement(U,{ref:w,isShown:h,isPageSettingsOpened:n,coords:v,callback:function(e,t){switch(e){case O.Duplicate:b(!1),r(t);break;case O.Delete:b(!1),s(t);break;case O.Settings:i(t)}}}),o.a.createElement(re,{className:"page-actions-button",width:32,height:32,position:"absolute",top:12,left:7,borderRadius:"round",_css13:t?"1":"0"},o.a.createElement(c.J,{size:32,color:"white",hoverColor:"white",activeColor:"tomato",outline:!0,onMouseEnter:function(){return d(!0)},onMouseLeave:function(){return d(!1)},onMouseDown:function(){return f(!0)},onMouseUp:function(){return f(!1)},onClick:function(e){return function(e){e.preventDefault(),e.stopPropagation();var t=e.currentTarget.getBoundingClientRect();j({x:t.x,y:t.y+t.height/2}),b(!h)}(e)}},o.a.createElement(c.bb,{color:g||h?"white":u?"tomato":"black"}))))}));function oe(){return(oe=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function ie(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var n=[],r=!0,a=!1,o=void 0;try{for(var i,s=e[Symbol.iterator]();!(r=(i=s.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){a=!0,o=e}finally{try{r||null==s.return||s.return()}finally{if(a)throw o}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}ae.displayName="PageActionsSmallPanel";var se=Object(b.d)(T.a.div).withConfig({displayName:"DraggableItem__DraggingPage"})(["position:absolute;box-sizing:border-box;cursor:pointer;z-index:2;pointer-events:none;user-select:none;-webkit-user-select:none;&:-webkit-drag{cursor:pointer;pointer-events:none;user-select:none;}"]),ce="undefined"!=typeof window&&(window.requestAnimationFrame||window.setImmediate)||function(e){return setTimeout(e,0)},le=Object(b.d)(c.i).withConfig({displayName:"DraggableItem___StyledBox"})(["box-shadow:0 1px 1px rgba(64,64,64,0.32);"]),ue=o.a.memo((function(e){var t=Object(a.useContext)(g),n=Object(a.useContext)(dn),i=Object(a.useRef)(null),c=Object(a.useRef)(null);Object(a.useEffect)((function(){return e.level&&V(!0),function(){Z.cancel()}}),[]);var l=Object(a.useMemo)((function(){return n.settingsBody?n.settingsBody.getBoundingClientRect():{}}),[n.settingsBody]),u=ie(Object(T.b)((function(){return{y:0}})),2),d=u[0].y,p=u[1],f=ie(Object(a.useState)({offset:0,state:!1}),2),m=f[0],h=f[1],b=o.a.useRef(),y=ie(Object(a.useState)(!1),2),v=y[0],j=y[1],w=o.a.useRef(0),O=o.a.useRef(0),S=n.settingsBody;Object(a.useEffect)((function(){return v?x():P(),function(){return P()}}),[v]);var x=function(){!w.current&&v&&m.state&&(w.current=ce(E))},P=function(){w.current&&(window.cancelAnimationFrame(w.current),w.current=0,O.current=0)},E=function e(){S&&v&&(S.scrollBy(0,O.current),w.current=ce(e))},_=ie(Object(a.useState)(null),2),C=_[0],I=_[1],F=ie(Object(a.useState)(null),2),G=F[0],W=F[1],U=ie(Object(a.useState)(!1),2),Y=U[0],V=U[1],J=o.a.useRef(),H=o.a.useRef(0);Object(a.useEffect)((function(){H.current=e.gridSize===me.Small?B:Y?D:A}),[e.gridSize,Y]);var Q=function(){C&&(Z.cancel(),C.style.removeProperty("box-shadow"),I(null))},Z=Object(k.a)((function(t,r){var a=n.pagesParams[r];if(!m.state||v||!a||a&&a.children.length&&a.collapsed||e.head)C&&C.style.removeProperty("box-shadow");else if(t&&b.current){var o=b.current.clientY,i=t.getBoundingClientRect();if(o<=i.top||o>=i.bottom)return;C?C.dataset.pageId!==t.dataset.pageId&&(C.style.removeProperty("box-shadow"),t.style.boxShadow="0 0 0 4px #f4f4f4, 0 0 0 ".concat(e.gridSize===me.Small?6:8,"px #B8B8B8"),I(t)):(t.style.boxShadow="0 0 0 4px #f4f4f4, 0 0 0 ".concat(e.gridSize===me.Small?6:8,"px #B8B8B8"),I(t))}}),800),K=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t?(e.style.transition="height ".concat(L(),"s linear 0s"),e.style.height="0px",setTimeout((function(){e.remove()}),Math.round(100*parseInt(L())))):e.remove()},$=function(){!function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];G&&G.elem&&(K(G.elem,e),W(null))}(),document.querySelectorAll(".drag-shadow-block").forEach((function(e){e.remove()}))},ee=function(t,n){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3?arguments[3]:void 0,o=document.createElement("div");return o.className="drag-shadow-block",o.style.width=e.gridSize===me.Small?"".concat(M,"px"):"".concat(a?z:R,"px"),o.style.marginTop="6px",o.style.marginBottom="6px",o.style.marginLeft=a?"16px":"0",o.style.boxSizing="border-box",o.style.borderRadius="4px",r?(o.style.height="0px",o.style.transition="height ".concat(L(),"s linear 0s")):o.style.height="".concat(H.current,"px"),{pageId:t,position:n,elem:o}},te=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,o=null!==a?a:Y,i=ee(e,n,r,o);G&&G.elem&&K(G.elem,r),n===en.After||n===en.AfterOutside?t.after(i.elem):t.before(i.elem),r&&ce((function(){i.elem.style.height="".concat(H.current,"px")})),W(i)},ne=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=t.dataset.pageLevel&&+t.dataset.pageLevel?t:t.parentNode;e?e.pageId!==t.dataset.pageId&&e.position!==n?te(t.dataset.pageId,a,n,!1,r):e.pageId===t.dataset.pageId&&e.position===n||te(t.dataset.pageId,a,n,!1,r):te(t.dataset.pageId,t,n,!1,r)},re=function(){var a=0;if(i.current){a=i.current.getBoundingClientRect().top;var o=n.settingsBody;e.gridSize===me.Standard&&o&&o.scrollTop&&o.scrollTop+o.clientHeight>=o.scrollHeight&&(a+=40),Y&&i.current.parentNode&&(i.current.parentNode.style.height="auto",J.current=e.page.parentPage),function(){var t=e.level?i.current:i.current.parentNode;if(t){if(1===n.pages.length||e.page.parentPage&&1===n.pagesParams[e.page.parentPage].children.length)return void te(e.page._id,t,en.After);var r=n.pages.findIndex((function(t){return t._id===e.page._id})),a=n.pages[r-1];if(a&&a.parentPage===e.page.parentPage)return void te(a._id,t.previousSibling,en.After);var o=n.pages[r+1];if(o&&o.parentPage===e.page.parentPage)return void te(o._id,t.nextSibling,en.Before)}te(e.page._id,i.current.parentNode,en.After)}()}h({offset:a,state:!0}),t.dispatch({type:r.SetDragging,payload:!0})},ae=function(){v&&j(!1),b.current=void 0,Z.cancel();var a={changingId:e.page._id};if(C&&C.dataset.pageId?(a.targetId=C.dataset.pageId,a.position=en.Inside):G&&(a.targetId=G.pageId,a.position=G.position),Q(),document.querySelectorAll(".page-list-item-picture").forEach((function(e){e.style.removeProperty("box-shadow")})),$(),a.changingId&&a.targetId&&a.position){var o=n.getNewPageOrderElement(a);if(o instanceof Error)return console.warn(o),Error;n.reorderPage(e.page._id,o)}h({offset:0,state:!1}),t.dispatch({type:r.SetDragging,payload:!1})},ue=Object(N.a)((function(t){var r=t.down,a=ie(t.movement,2)[1],o=(ie(t.direction,2)[1],t.event),i=a;if(c.current&&m.state&&(b.current=o,i=pe(a),ge(a),v||de(o,c.current)),m.state!==r){var s=n.pagesParams[e.page._id];if(s&&s.children.length&&s.collapsed)return;r?re():ae()}p({y:r?i:0,immediate:r})}),{capture:!0,filterTaps:!0,axis:"y"}),de=function(t,r){r.hidden=!0;var a=document.elementFromPoint(t.clientX,t.clientY);if(r.hidden=!1,a){var o,i,s=a.closest(".page-list-draggable-item");if(s){if(s&&s.dataset.pageId&&s.dataset.pageId!==e.page._id){var c=s.querySelector(".page-list-item-picture"),l=(o=r.getBoundingClientRect(),i=c.getBoundingClientRect(),o.bottom-o.height/2-(i.bottom-i.height/2));Z(c,s.dataset.pageId);var u=Boolean(s.dataset.pageLevel&&!!parseInt(s.dataset.pageLevel)),d=!1;u!==Y&&(d=!0,u?s.parentNode&&(s.parentNode.style.height="auto",J.current=s.parentNode.dataset.parentId):J.current=void 0,V(u)),l>=0?ne(G,s,en.After,d?u:null):l<=0&&ne(G,s,en.Before,d?u:null)}}else Q(),Y&&function(e,t){if(J.current&&e.target&&e.target.classList.contains("drag-shadow-block")){var r=e.target.parentNode.getBoundingClientRect();if(t.getBoundingClientRect().bottom-r.bottom>5){var a=n.pagesParams[J.current];a&&(J.current=void 0,te(a.children[a.children.length-1],e.target.parentNode.parentNode,en.AfterOutside,!1,!1),V(!1))}}}(t,r)}},pe=function(e){if(!n.pagesListContainer)return e;var t=n.pagesListContainer.getBoundingClientRect();return m.offset+e<t.top-0?e-(m.offset+e-(t.top-0)):m.offset+H.current+e>t.bottom+0?e-(m.offset+H.current+e-(t.bottom+0)):e},ge=function(e){if(n.settingsBody)if(m.offset+e<l.top){var t=Math.ceil((m.offset+e-l.top)/4);n.settingsBody.scrollTop?(O.current=t,v||j(!0)):v&&j(!1)}else if(m.offset+H.current+e>l.bottom){var r=Math.ceil((m.offset+H.current+e-l.bottom)/4);n.settingsBody.scrollTop+n.settingsBody.clientHeight<n.settingsBody.scrollHeight?(O.current=r,v||j(!0)):v&&j(!1)}else v&&j(!1)};return o.a.createElement(o.a.Fragment,null,o.a.createElement("div",oe({className:"page-list-draggable-item","data-page-id":e.page._id,"data-page-level":e.level,ref:i},ue(),{style:{boxSizing:"border-box",display:m.state?"none":"block"}}),o.a.createElement(q,e)),m.state&&n.dragContainer?s.a.createPortal(o.a.createElement(se,{ref:c,style:{transform:d.interpolate((function(e){return"translate(0, ".concat(e,"px)")})),top:m.offset}},o.a.createElement(le,{width:e.gridSize===me.Small?"".concat(M,"px"):"".concat(Y?z:R,"px"),height:"".concat(H.current,"px"),ml:Y?"40px":"24px",bg:"white",borderRadius:"s"},o.a.createElement(X,{url:e.page.screenshot}))),n.dragContainer):null)}));function de(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var n=[],r=!0,a=!1,o=void 0;try{for(var i,s=e[Symbol.iterator]();!(r=(i=s.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){a=!0,o=e}finally{try{r||null==s.return||s.return()}finally{if(a)throw o}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}ue.displayName="DraggableItem";var pe=Object(b.d)(c.i).withConfig({displayName:"Branch___StyledBox"})(["height:",";overflow-x:hidden;transition:height 200ms ease;"],(function(e){return e._css})),ge=o.a.memo((function(e){var t=e.page,n=e.gridSize,r=e.level,i=void 0===r?0:r,s=e.isCmdPressed,l=Object(a.useContext)(dn),u=de(Object(a.useState)(null),2),d=u[0],p=u[1],g=Object(a.useRef)(null),f=!(!t.children||!t.children.length),m=!l.pagesParams[t._id]||l.pagesParams[t._id].collapsed,h=t.children&&t.children.length?t.children.map((function(e){return e.num_id})).join(";"):"";Object(a.useEffect)((function(){ce((function(){g&&g.current&&(g.current.style.height="auto",p(g.current.scrollHeight),g.current.style.removeProperty("height"))}))}),[n,h]),g&&g.current&&g.current.style.removeProperty("height");var b=Object(a.useCallback)((function(){l.setPageCollapse(t._id,!m)}),[t._id,m]);return o.a.createElement(c.i,{position:"relative"},o.a.createElement(ue,{page:t,gridSize:n,level:i,head:f,isCmdPressed:s,onCollapsed:b,isPageCollapsed:m}),t.children&&f?o.a.createElement(pe,{className:"page-children-container",ref:g,"data-parent-id":t._id,_css:m?d?"".concat(d,"px"):"auto":"0px"},t.children.map((function(e){return e.children?o.a.createElement(ge,{key:e._id,page:e,gridSize:n,level:i+1,isCmdPressed:s}):o.a.createElement(ue,{key:e._id,page:e,gridSize:n,level:i+1,isCmdPressed:s})}))):null)}));function fe(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var n=[],r=!0,a=!1,o=void 0;try{for(var i,s=e[Symbol.iterator]();!(r=(i=s.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){a=!0,o=e}finally{try{r||null==s.return||s.return()}finally{if(a)throw o}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}ge.displayName="Branch";var me,he=function(e){var t=e.gridSize,n=Object(a.useContext)(g),r=Object(a.useContext)(dn);Object(a.useEffect)((function(){window.RM.constructorRouter.pageOrder.fixPageOrder(window.RM.constructorRouter.mag)}),[n.isSettingsOpened]);var i=fe(Object(a.useState)(!1),2),s=i[0];i[1];return o.a.createElement(c.r,{id:"page-list-container",flexDirection:"column",justifyContent:"left",flexWrap:"wrap",px:3,py:"6px"},r.pagesTree.map((function(e){return o.a.createElement(ge,{key:e._id,page:e,isCmdPressed:s,gridSize:t})})))};function be(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var n=[],r=!0,a=!1,o=void 0;try{for(var i,s=e[Symbol.iterator]();!(r=(i=s.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){a=!0,o=e}finally{try{r||null==s.return||s.return()}finally{if(a)throw o}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}!function(e){e[e.Standard=0]="Standard",e[e.Small=1]="Small"}(me||(me={}));var ye,ve=Object(b.d)(c.i).withConfig({displayName:"SettingsBody___StyledBox"})(["overflow-x:visible;overflow-y:auto;user-select:",";"],(function(e){return e._css})),je=Object(b.d)(c.O).withConfig({displayName:"SettingsBody___StyledStandardGridIcon"})(["cursor:pointer;rect{fill:",";}"],(function(e){return e._css2})),we=Object(b.d)(c.N).withConfig({displayName:"SettingsBody___StyledSmallGridIcon"})(["cursor:pointer;path{fill:",";}"],(function(e){return e._css3})),Oe=function(){var e,t=Object(a.useContext)(dn),n=be(Object(a.useState)(me.Standard),2),r=n[0],i=n[1];return o.a.createElement(ve,{id:"project-settings-body",width:1,height:"calc(100% - 72px - 75px)",position:"relative",_css:t?"none":"auto"},o.a.createElement(c.i,{px:3},o.a.createElement(c.i,null,o.a.createElement(c.W,{color:"black",textStyle:"subheading"},t.project.title||"Project Title")),o.a.createElement(c.i,{mt:"7px",position:"relative"},o.a.createElement(c.W,{color:"darkGray",textStyle:"small"},(e=t.project).is_published?e.changed?"Unpublished changes":"Published ".concat(C()(e.published).format("MMM D, YYYY")):"Unpublished"),o.a.createElement(c.r,{mt:"14px",onClick:function(){return i((function(e){return e===me.Standard?me.Small:me.Standard}))}},o.a.createElement(c.i,null,o.a.createElement(je,{_css2:r===me.Standard?"#808080":"#B8B8B8"})),o.a.createElement(c.i,{ml:"1"},o.a.createElement(we,{_css3:r===me.Small?"#808080":"#B8B8B8"}))))),o.a.createElement(he,{gridSize:r}))};!function(e){e.Top="top",e.Right="right",e.Bottom="bottom",e.Left="left"}(ye||(ye={}));var Se=Object(b.d)(c.i).withConfig({displayName:"AddFromTemplatesPopup___StyledBox"})(["background-color:rgba(40,40,40,0.92);transform:",";transition:0.3s transform ease;"],(function(e){return e._css})),xe=Object(b.d)(c.i).withConfig({displayName:"AddFromTemplatesPopup___StyledBox2"})(["",""],(function(e){return e._css2})),Pe=Object(a.forwardRef)((function(e,t){var n=e.isShown,r=e.coords,i=e.transform,l=e.placement,u=e.children;if(!n)return null;var d=Object(a.useMemo)((function(){var e="";switch(l){case ye.Bottom:e="bottom: -16px; left: 24px; transform: rotate(90deg);"}return e}),[l]);return s.a.createPortal(o.a.createElement(Se,{ref:t,width:224,height:168,position:"absolute",top:"number"==typeof r.top?"".concat(r.top,"px"):"auto",right:"number"==typeof r.right?"".concat(r.right,"px"):"auto",bottom:"number"==typeof r.bottom?"".concat(r.bottom,"px"):"auto",left:"number"==typeof r.left?"".concat(r.left,"px"):"auto",zIndex:8e3,borderRadius:"l",_css:i||"none"},u,o.a.createElement(xe,{position:"absolute",_css2:d},o.a.createElement(c.Y,{color:"black"}))),document.body)}));Pe.displayName="AddFromTemplatesPopup";var Ee=Pe,_e=Object(b.d)(c.r).withConfig({displayName:"PopupBody___StyledFlex"})(["cursor:pointer;"]),Ce=Object(b.d)(c.r).withConfig({displayName:"PopupBody___StyledFlex2"})(["cursor:pointer;"]),ke=Object(b.d)(c.r).withConfig({displayName:"PopupBody___StyledFlex3"})(["background-image:",";background-position:center center;background-repeat:no-repeat;background-size:cover;"],(function(e){return e._css})),Te=function(e){var t=e.onMyTemplatesClick,n=e.onRmTemplatesClick,r=e.isUserTemplatesLoading,a=e.userTemplatesScreenshot;return o.a.createElement(c.r,{flexDirection:"column",color:"white",pt:3,pl:3,pb:3},o.a.createElement(_e,{alignItems:"center",onClick:function(e){e.preventDefault(),n()}},o.a.createElement(c.i,{width:88,height:60,borderRadius:"s",bg:"grey"}),o.a.createElement(c.W,{textStyle:"small",ml:3},"R/m templates")),o.a.createElement(Ce,{alignItems:"center",mt:3,onClick:function(e){return function(e){e.preventDefault(),t()}(e)}},o.a.createElement(ke,{width:88,height:60,borderRadius:"s",justifyContent:"center",alignItems:"center",bg:"grey",_css:a?"url(".concat(a,")"):"none"},!a&&r&&o.a.createElement(c.B,{bgColor:"transparent"})),o.a.createElement(c.W,{textStyle:"small",ml:3},"My templates")))};function Ne(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var n=[],r=!0,a=!1,o=void 0;try{for(var i,s=e[Symbol.iterator]();!(r=(i=s.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){a=!0,o=e}finally{try{r||null==s.return||s.return()}finally{if(a)throw o}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var Ie=Object(b.d)(c.i).withConfig({displayName:"PageTemplatesModal___StyledBox"})(["overflow-y:auto;"]),Ae=o.a.memo((function(e){var t=e.isShown,n=e.width,r=e.height,i=e.onClose,l=e.isLoading,u=e.children,d=Object(a.useRef)(null),p=Ne(Object(a.useState)(null),2),g=p[0],f=p[1];return Object(a.useEffect)((function(){return t?f(window.RM.constructorRouter.showBlockLayer(i,{transparent:!0})):g&&window.RM.constructorRouter.hideBlockLayer(g),function(){g&&window.RM.constructorRouter.hideBlockLayer(g)}}),[t]),s.a.createPortal(o.a.createElement(o.a.Fragment,null,t?o.a.createElement(Ie,{ref:d,width:"".concat(n,"px"),height:"".concat(r,"px"),position:"absolute",top:"calc(50% - ".concat(r/2,"px)"),left:"calc(50% - ".concat(n/2,"px)"),zIndex:9999,borderRadius:"l",bg:"black"},l?o.a.createElement(c.r,{width:"100%",height:"100%",justifyContent:"center",alignItems:"center"},o.a.createElement(c.B,{bgColor:"transparent"})):u):null),document.body)}));Ae.displayName="PageTemplatesModal";var De=Ae,Be=n("eQZl");function Re(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var n=[],r=!0,a=!1,o=void 0;try{for(var i,s=e[Symbol.iterator]();!(r=(i=s.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){a=!0,o=e}finally{try{r||null==s.return||s.return()}finally{if(a)throw o}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var ze=function(e){var t=e.getPageAlert,n=e.isShown,r=e.onClose,i=e.addPageFromTemplate,s=Re(Object(a.useState)(null),2),c=s[0],l=s[1],u=Object(a.useRef)(!1),d=function(e){i(e)},p=function(e){if(e.templates&&e.templates.length&&!u.current){var t=0;u.current=!0,function n(){i(e.templates[t++],!0).then((function(){t!==e.templates.length?n():u.current=!1})).catch((function(){u.current=!1}))}()}};return Object(a.useEffect)((function(){var e=t(),n=new Be.a({router:window.RM.constructorRouter,pagesAlert:e.render,onClose:r,overlayTransparent:!0});n.on("add-page",d),n.on("add-multiple",p),l(n)}),[]),Object(a.useEffect)((function(){c&&(n?c.show():c.hide())}),[n]),o.a.createElement(o.a.Fragment,null)};function Me(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var n=[],r=!0,a=!1,o=void 0;try{for(var i,s=e[Symbol.iterator]();!(r=(i=s.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){a=!0,o=e}finally{try{r||null==s.return||s.return()}finally{if(a)throw o}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var Le=Object(b.d)(c.r).withConfig({displayName:"MyTemplatesModalBody___StyledFlex"})(["align-content:flex-start;overflow-y:auto;"]),Fe=Object(b.d)(c.r).withConfig({displayName:"MyTemplatesModalBody___StyledFlex2"})(["cursor:pointer;"]),Ge=Object(b.d)(c.r).withConfig({displayName:"MyTemplatesModalBody___StyledFlex3"})(["background-image:url(",");background-position:center center;background-repeat:no-repeat;background-size:cover;cursor:pointer;&:hover{.delete-template-button{opacity:1;}}"],(function(e){return e._css})),We=Object(b.d)(c.J).withConfig({displayName:"MyTemplatesModalBody___StyledRoundButton"})(["position:absolute;top:8px;right:8px;opacity:0;transition:opacity 0.15s ease;"]),Ue=function(e){var t=e.templates,n=e.newTemplateTitle,r=e.createNewUserTemplate,i=e.addPageFromTemplate,s=e.deleteUserTemplate,l=Me(Object(a.useState)(!1),2),u=l[0],d=l[1],p=Me(Object(a.useState)(!1),2),g=p[0],f=p[1],m=Me(Object(a.useState)(!1),2),h=m[0],b=m[1];return o.a.createElement(Le,{width:"100%",height:"100%",py:"24px",px:"68px",flexWrap:"wrap",borderRadius:"l"},o.a.createElement(Fe,{width:"216px",height:"141px",mb:"24px",mx:"12px",position:"relative",justifyContent:"center",alignItems:"center",bg:"darkGray",borderRadius:"s",onClick:function(e){e.preventDefault(),e.stopPropagation(),u||(d(!0),r().then((function(){d(!1)})).catch((function(){d(!1)})))}},u?o.a.createElement(c.B,{bgColor:"transparent"}):o.a.createElement(c.G,{color:"black"}),o.a.createElement(c.i,{position:"absolute",top:100},o.a.createElement(c.W,{textStyle:"small",textAlign:"center"},n))),t.map((function(e){return o.a.createElement(Ge,{key:e.id,width:"216px",height:"141px",mb:"24px",mx:"12px",position:"relative",bg:"darkGray",borderRadius:"s",onClick:function(t){return function(e,t){e.preventDefault(),e.stopPropagation(),i({template:t.id,custom:!0,specialScreenshot:t.screenshot})}(t,e)},_css:e.screenshot},o.a.createElement(We,{size:32,className:"delete-template-button",color:"white",hoverColor:"white",activeColor:"tomato",outline:!0,onMouseEnter:function(){return f(e.id)},onMouseLeave:function(){return f(!1)},onMouseDown:function(){return b(e.id)},onMouseUp:function(){return b(!1)},onClick:function(t){return function(e,t){e.preventDefault(),e.stopPropagation(),s(t)}(t,e.id)}},o.a.createElement(c.n,{color:h&&h===e.id?"white":g&&g===e.id?"tomato":"black"})))})))};function Ye(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var n=[],r=!0,a=!1,o=void 0;try{for(var i,s=e[Symbol.iterator]();!(r=(i=s.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){a=!0,o=e}finally{try{r||null==s.return||s.return()}finally{if(a)throw o}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var Ve=o.a.memo((function(e){var t=e.isTrashOpened,n=e.isSettingsOpened,r=Object(a.useContext)(dn),i=Object(a.useRef)(null),s=Ye(Object(a.useState)(!1),2),l=s[0],u=s[1],d=Ye(Object(a.useState)(!1),2),p=d[0],g=d[1],f=Ye(Object(a.useState)(!1),2),m=f[0],h=f[1],b=Ye(Object(a.useState)(!1),2),y=b[0],v=b[1];Object(a.useEffect)((function(){n&&l&&(v(!0),r.getUserTemplates().then((function(){v(!1)})).catch((function(e){v(!1),e&&console.warn(e.message)})))}),[n,l]);var j=Object(a.useMemo)((function(){var e=r.pages.find((function(e){return e.num===r.currentPageNum}));return e&&e.title?e.title:"page ".concat(r.currentPageNum)}),[r.currentPageNum]),w=function(e){e.preventDefault(),e.target&&i.current&&!i.current.contains(e.target)&&u(!1)};Object(a.useEffect)((function(){return l?window.addEventListener("click",w):window.removeEventListener("click",w),function(){window.removeEventListener("click",w)}}),[l]);var O=function(e,t){return r.addNewPage(r.currentPageNum,e,t)};return o.a.createElement(o.a.Fragment,null,o.a.createElement(c.j,{color:"darkGray",textStyle:"small",onClick:function(e){e.preventDefault(),u(!l)}},"Add"),o.a.createElement(Ee,{ref:i,isShown:l,coords:{right:8,bottom:80},transform:t?"translateX(-240px)":"translateX(0px)",placement:ye.Bottom},o.a.createElement(Te,{onRmTemplatesClick:function(){u(!1),h(!0)},onMyTemplatesClick:function(){u(!1),g(!0)},isUserTemplatesLoading:y,userTemplatesScreenshot:r.userTemplates.length?r.userTemplates[0].screenshot:void 0})),o.a.createElement(De,{width:880,height:576,isShown:p,onClose:function(){u(!1),g(!1)},isLoading:y},o.a.createElement(Ue,{templates:r.userTemplates,newTemplateTitle:"Create template from ".concat(j),createNewUserTemplate:r.createTemplateFromCurrentPage,addPageFromTemplate:O,deleteUserTemplate:r.deleteUserTemplate})),o.a.createElement(ze,{isShown:m,onClose:function(){u(!1),h(!1)},addPageFromTemplate:O,getPageAlert:r.getPageAlert}))}));Ve.displayName="AddFromTemplatesButton";var Xe=Ve,Je=n("YqYG"),He=function(){var e=Object(a.useContext)(g),t=Object(a.useContext)(dn),n=Object(a.useRef)(new Je.default({$parent:document.querySelector("body > .popups"),router:window.RM.constructorRouter,opts:{type:"type-more-pages",is_contributor:!window.RM.constructorRouter.isOwner,owner_email:t.project.user?t.project.user.email:""},alert_source:"custom sharing"})).current;return o.a.createElement(c.i,{width:1,height:80,position:"absolute",left:0,bottom:0},o.a.createElement(c.i,{position:"absolute",left:24,bottom:36},o.a.createElement(Xe,{isTrashOpened:e.isTrashOpened,isSettingsOpened:e.isSettingsOpened})),o.a.createElement(c.j,{position:"absolute",left:107,bottom:31},o.a.createElement(c.G,{onClick:function(e){e.preventDefault(),t.addNewPage(t.currentPageNum).then((function(){})).catch((function(e){e&&e.err&&"permission_denied"===e.err&&n.render()}))}})),(t.project.has_deleted_pages||e.isTrashOpened)&&o.a.createElement(c.j,{color:e.isTrashOpened?"tomato":"darkGray",textStyle:"small",position:"absolute",right:24,bottom:36,onClick:function(n){n.preventDefault(),(t.project.has_deleted_pages||e.isTrashOpened)&&e.dispatch({type:r.ToggleTrash})}},e.isTrashOpened?"Close":"Bin"))};function Qe(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var n=[],r=!0,a=!1,o=void 0;try{for(var i,s=e[Symbol.iterator]();!(r=(i=s.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){a=!0,o=e}finally{try{r||null==s.return||s.return()}finally{if(a)throw o}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var Ze=b.d.div.withConfig({displayName:"Trash__TrashSidebar"})(["height:100%;width:240px;padding:12px 22px;box-sizing:border-box;position:fixed;top:0;right:0;bottom:0;z-index:4000;background-color:",";overflow-x:hidden;overflow-y:auto;transform:translateX( "," );transition:transform 300ms ease;"],Object(h.themeGet)("colors.black"),(function(e){return e.isSettingsOpened?e.isTrashOpened?"0px":"240px":e.isTrashOpened?"480px":"240px"})),qe=o.a.memo((function(){var e=Object(a.useContext)(g),t=Object(a.useContext)(dn);Object(a.useEffect)((function(){e.isTrashOpened?(document.body.classList.add("trash-is-opened"),t.updateTrash()):document.body.classList.remove("trash-is-opened")}),[e.isTrashOpened]);var n=function(e){return t.restorePage(e)},r=function(e){return t.deletePagesFromTrash([e])};return o.a.createElement(Ze,{isTrashOpened:e.isTrashOpened,isSettingsOpened:e.isSettingsOpened},o.a.createElement(c.i,{height:"calc(100% - 80px)",overflow:"auto"},o.a.createElement(c.i,{mb:28},o.a.createElement(c.W,{color:"white",textStyle:"subheading",textAlign:"left"},"Deleted pages")),t.trashPages.map((function(e){return o.a.createElement(at,{key:e._id,page:e,isOwner:t.isOwner,onRestorePage:n,onDeletePage:r})}))),t.trashPages.length?o.a.createElement(it,{onEmptyTrash:function(){t.isOwner&&t.trashPages&&t.emptyTrash()},isOwner:t.isOwner}):null)}));qe.displayName="Trash";var Ke=Object(b.d)(c.i).withConfig({displayName:"Trash___StyledBox"})([":hover{.trash-page-actions{opacity:1;}}"]),$e=Object(b.d)(c.r).withConfig({displayName:"Trash___StyledFlex"})(["opacity:0;transition:opacity 200ms ease;"]),et=Object(b.d)(c.r).withConfig({displayName:"Trash___StyledFlex2"})(["cursor:pointer;border:1px solid rgba(128,128,128,0.16);&:hover{opacity:0.8;}"]),tt=Object(b.d)(c.r).withConfig({displayName:"Trash___StyledFlex3"})(["cursor:pointer;border:1px solid rgba(128,128,128,0.16);transition:opacity 0.2s ease;&:hover{opacity:0.8;}"]),nt=Object(b.d)(c.r).withConfig({displayName:"Trash___StyledFlex4"})(["cursor:pointer;border:1px solid rgba(128,128,128,0.16);transition:opacity 0.2s ease;&:hover{opacity:0.8;}"]),rt=Object(b.d)(c.r).withConfig({displayName:"Trash___StyledFlex5"})(["cursor:",";border:1px solid rgba(128,128,128,0.16);&:hover{opacity:0.8;}"],(function(e){return e._css})),at=o.a.memo((function(e){var t=e.page,n=e.isOwner,r=e.onRestorePage,i=e.onDeletePage,s=Qe(Object(a.useState)(!1),2),l=s[0],u=s[1];return o.a.createElement(c.i,{mb:12,ml:"2px"},o.a.createElement(Ke,{width:192,height:124,bg:"darkGray",borderRadius:"s",position:"relative"},o.a.createElement(X,{url:t.screenshot}),o.a.createElement($e,{className:"trash-page-actions",width:176,height:32,justifyContent:"space-between",position:"absolute",left:8,bottom:8},l?o.a.createElement(et,{width:80,height:32,alignItems:"center",justifyContent:"center",bg:"tomato",borderRadius:"xl",onClick:function(e){e.preventDefault(),n&&i(t._id)}},o.a.createElement(c.W,{textStyle:"small",color:"white"},"Yes")):o.a.createElement(tt,{width:80,height:32,alignItems:"center",justifyContent:"center",bg:"white",borderRadius:"xl",onClick:function(e){e.preventDefault(),r(t._id)}},o.a.createElement(c.W,{textStyle:"small",color:"black"},"Restore")),l?o.a.createElement(nt,{width:80,height:32,alignItems:"center",justifyContent:"center",bg:"white",borderRadius:"xl",onClick:function(e){e.preventDefault(),u(!1)}},o.a.createElement(c.W,{textStyle:"small",color:"black"},"Cancel")):o.a.createElement(rt,{width:80,height:32,alignItems:"center",justifyContent:"center",bg:"white",borderRadius:"xl",onClick:function(e){e.preventDefault(),u(!0)},_css:n?"pointer":"not-allowed"},o.a.createElement(c.W,{textStyle:"small",color:n?"black":"gray"},"Delete")))),o.a.createElement(c.i,{mt:"7px"},o.a.createElement(c.W,{textStyle:"small",color:"white"},t.title?t.title:"Page Title")))}));at.displayName="TrashPage";var ot=Object(b.d)(c.j).withConfig({displayName:"Trash___StyledButton"})(["cursor:",";"],(function(e){return e._css2})),it=o.a.memo((function(e){var t=e.onEmptyTrash,n=e.isOwner;return o.a.createElement(c.r,{height:80,justifyContent:"center",alignItems:"center",borderTop:"2px solid #B8B8B8",position:"relative",top:12},o.a.createElement(ot,{textStyle:"small",color:n?"white":"gray",onClick:t,_css2:n?"pointer":"not-allowed"},"Empty bin"))}));it.displayName="TrashFooter";var st=qe,ct=n("tZHv");function lt(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var n=[],r=!0,a=!1,o=void 0;try{for(var i,s=e[Symbol.iterator]();!(r=(i=s.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){a=!0,o=e}finally{try{r||null==s.return||s.return()}finally{if(a)throw o}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function ut(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function dt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ut(n,!0).forEach((function(t){pt(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ut(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function pt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var gt=b.d.label.withConfig({displayName:"SeoSettings___StyledLabel"})(["color:",";",";"],(function(e){return e._css}),(function(e){return e._css2})),ft=b.d.label.withConfig({displayName:"SeoSettings___StyledLabel2"})(["color:",";",";"],(function(e){return e._css3}),(function(e){return e._css4})),mt=b.d.label.withConfig({displayName:"SeoSettings___StyledLabel3"})(["color:",";",";"],(function(e){return e._css5}),(function(e){return e._css6})),ht=b.d.label.withConfig({displayName:"SeoSettings___StyledLabel4"})(["color:",";",";"],(function(e){return e._css7}),(function(e){return e._css8})),bt=o.a.memo((function(e){var t=e.currentPage,n=Object(a.useContext)(g),r=Object(a.useContext)(dn),i=function(){var e={title:"",description:"",keywords:""};return t&&t.seo&&(e=dt({},e,{},t.seo)),e},s=lt(Object(a.useState)((function(){return i()})),2),l=s[0],u=s[1],d=lt(Object(a.useState)((function(){return t&&t.uri?t.uri:""})),2),p=d[0],f=d[1],m=lt(Object(a.useState)(null),2),b=m[0],y=m[1];Object(a.useEffect)((function(){u(i()),t&&f(t.uri||""),b&&y(null)}),[t]);var v,j,w,O=function(e){var n=e.target.getAttribute("name");if(n&&void 0!==l[n]&&t){var a=dt({},l,{},pt({},n,e.target.value)),o=r.pageSave(t._id,{seo:a});!o||o instanceof Error||o.done((function(e){})).fail((function(){}))}};return o.a.createElement("form",null,o.a.createElement(c.i,{mt:"12px"},o.a.createElement(gt,{htmlFor:"title",_css:Object(h.themeGet)("colors.white"),_css2:Object(h.themeGet)("textStyles.small")},"Title"),o.a.createElement(c.w,{name:"title",id:"title",color:"white",placeholder:"Cover",translate:"no",maxLength:128,autoSize:!0,mt:"4px",defaultValue:l.title,onBlur:O})),o.a.createElement(c.i,{mt:"2px"},o.a.createElement(ft,{htmlFor:"description",_css3:Object(h.themeGet)("colors.white"),_css4:Object(h.themeGet)("textStyles.small")},"Description"),o.a.createElement(c.w,{name:"description",id:"description",color:"white",placeholder:"What's it about...",translate:"no",maxLength:2048,autoSize:!0,mt:"4px",defaultValue:l.description,onBlur:O})),o.a.createElement(c.i,{mt:"2px"},o.a.createElement(mt,{htmlFor:"keywords",_css5:Object(h.themeGet)("colors.white"),_css6:Object(h.themeGet)("textStyles.small")},"Keywords"),o.a.createElement(c.w,{name:"keywords",id:"keywords",color:"white",placeholder:"Design, fashion",translate:"no",spellCheck:!1,autoSize:!0,mt:"4px",defaultValue:l.keywords,onBlur:O})),o.a.createElement(c.i,{mt:"2px"},o.a.createElement(ht,{htmlFor:"link",_css7:Object(h.themeGet)("colors.white"),_css8:Object(h.themeGet)("textStyles.small")},(v=r.project,j=ct.a.readymag_host.split("//")[1],w=v.domain,v.user.domain||w||j)),o.a.createElement(c.r,{flexWrap:"wrap"},o.a.createElement(c.W,{color:"white",fontSize:"small"},function(e){var t=e.domain,n=e.user.domain,r=e.uri,a=e.user.uri;return n?"/"+r+"/":t?"/":"/"+a+"/"+r+"/"}(r.project)),o.a.createElement(c.v,{name:"link",id:"link",type:"text",color:"white",fontSize:"regular",spellCheck:!1,placeholder:t?"/".concat(t.num.toString()):"/",value:b||p,onKeyDown:function(e){y(null),13===e.keyCode&&(e.preventDefault(),e.currentTarget.blur())},onChange:function(e){if(t){var r=/[^A-Za-z0-9_.+-]/g,a=e.currentTarget.value;r.test(a)&&(a=a.replace(r,""));var o=n.validatePageUri(t._id,a);if(o){var i={hyphen:"The link cannot begin or end with a hyphen",onlyNumbers:"The link cannot be numeric",uriLength:"The linkâs max length is 128 characters",used:"This link is already used",pageNotFound:"Can't found current page"}[Object.keys(o)[0]];y(i)}else f(a)}},onBlur:function(e){if(t&&!b){var n=e.currentTarget.value,a=r.pageSave(t._id,{uri:n});!a||a instanceof Error||a.done((function(e){f(e.uri||"")})).fail((function(){}))}}}))))})),yt=n("LDvm"),vt=n("+9Qk");function jt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function wt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?jt(n,!0).forEach((function(t){Ot(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):jt(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Ot(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function St(e,t,n,r,a,o,i){try{var s=e[o](i),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,a)}function xt(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var n=[],r=!0,a=!1,o=void 0;try{for(var i,s=e[Symbol.iterator]();!(r=(i=s.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){a=!0,o=e}finally{try{r||null==s.return||s.return()}finally{if(a)throw o}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var Pt,Et=Object(b.d)(c.j).withConfig({displayName:"SocialSettings__CustomizeButton"})(["width:100%;height:40px;border:solid 2px ",";border-radius:32px;"],Object(h.themeGet)("colors.darkGray"));!function(e){e.Default="default",e.Custom="custom",e.Inherited="inherited"}(Pt||(Pt={}));var _t=Object(b.d)(c.i).withConfig({displayName:"SocialSettings___StyledBox"})(["box-shadow:0 1px 1px rgba(64,64,64,0.32);cursor:pointer;"]),Ct=Object(b.d)(c.i).withConfig({displayName:"SocialSettings___StyledBox2"})(["background-image:",";background-size:cover;background-repeat:no-repeat;"],(function(e){return e._css})),kt=Object(b.d)(c.w).withConfig({displayName:"SocialSettings___StyledInlineTextArea"})(["&:disabled{opacity:0.4;}"]),Tt=Object(b.d)(c.w).withConfig({displayName:"SocialSettings___StyledInlineTextArea2"})(["&:disabled{opacity:0.4;}"]),Nt=b.d.label.withConfig({displayName:"SocialSettings___StyledLabel"})(["color:",";",";"],(function(e){return e._css2}),(function(e){return e._css3})),It=Object(b.d)(c.w).withConfig({displayName:"SocialSettings___StyledInlineTextArea3"})(["&:disabled{opacity:0.4;}"]),At=b.d.label.withConfig({displayName:"SocialSettings___StyledLabel2"})(["color:",";",";"],(function(e){return e._css4}),(function(e){return e._css5})),Dt=o.a.memo((function(e){var t=e.currentPage,n=Object(a.useContext)(dn),r=new Je.default({$parent:document.querySelector("body > .popups"),router:window.RM.constructorRouter,opts:{type:"type-custom-sharing",is_contributor:!window.RM.constructorRouter.isOwner,owner_email:n.project.user?n.project.user.email:""},alert_source:"custom sharing"}),i=xt(Object(a.useState)((function(){return!!window.RM.constructorRouter.me&&!!(window.RM.constructorRouter.me.get("permissions")||{}).custom_sharing})),1)[0],s=xt(Object(a.useState)((function(){return n.project.master_share_pid||null})),2),l=s[0],u=s[1],d=function(e){var n=e||t;return n?l?l===n._id?Pt.Custom:Pt.Inherited:n.custom_shares?Pt.Custom:Pt.Default:Pt.Default},p=xt(Object(a.useState)(d()),2),g=p[0],f=p[1],m=function(){return g===Pt.Default||g===Pt.Inherited},b=function(e){if(e.custom_shares){var t=e.custom_shares;if(!t.image){var n=Y.default.screenshotSize(256),r=Y.default.addFilenameComponent(e.screenshot,n);t.image=r}return t}return{description:"",title:"",tweet:"",image:""}},y=function(e){var r=e||t;if(!r)return null;var a=n.project.domain||n.project.user&&n.project.user.domain,o=vt.a.getDefaultShare(r,n.project,{customDomain:Boolean(a)});if(l){if(l===r._id)return b(r);var i=n.pages.find((function(e){return e._id===l}));if(i)return b(i)}else if(r.custom_shares)return b(r);return o},j=xt(Object(a.useState)((function(){return y()})),2),w=j[0],O=j[1];Object(a.useEffect)((function(){return O(y()),f(d()),function(){O(null)}}),[t]);var S=function(){if(t)return n.pageSave(t._id,{custom_shares:w})},x=xt(Object(a.useState)(!1),2),P=x[0],E=x[1],_=function(){var e,t=(e=regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.size>ct.a.UPLOAD_IMAGE_SIZE_LIMIT)){e.next=3;break}return console.error(ct.a.MSG_UPLOAD_IMAGE_SIZE_ERROR),e.abrupt("return");case 3:return E(!0),e.prev=4,e.next=7,Object(yt.q)("share-upload",t);case 7:(n=e.sent)&&n.picture&&n.picture.url&&w&&(O(wt({},w,{},{image:n.picture.url})),!(r=S())||r instanceof Error||r.done((function(){E(!1)})).fail((function(){}))),e.next=13;break;case 11:e.prev=11,e.t0=e.catch(4);case 13:E(!1);case 14:case"end":return e.stop()}}),e,null,[[4,11]])})),function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function i(e){St(o,r,a,i,s,"next",e)}function s(e){St(o,r,a,i,s,"throw",e)}i(void 0)}))});return function(e){return t.apply(this,arguments)}}(),C=function(e){var r=e.target.getAttribute("name");if(r&&void 0!==w[r]&&t){var a=wt({},w,{},Ot({},r,e.target.value)),o=n.pageSave(t._id,{custom_shares:a});!o||o instanceof Error||o.done((function(){})).fail((function(){}))}},k=function(){return Boolean(t&&l&&t._id===l)};return o.a.createElement("form",null,o.a.createElement(c.i,{mt:"12px",position:"relative"},o.a.createElement(c.W,{color:"white",textStyle:"small"},"OpenGraph"),o.a.createElement(c.i,{position:"absolute",right:0,top:0},o.a.createElement(v,{onClick:function(e){e.preventDefault()}}))),o.a.createElement(c.i,{width:192,height:104,mt:"12px"},o.a.createElement(c.q,{accept:"image/*",dropFile:!0,readFileData:!1,onChange:_,disabled:m()},o.a.createElement(_t,{width:192,height:104,bg:"darkGrey",borderRadius:"s",position:"relative"},P&&o.a.createElement(c.i,{position:"absolute",top:"28px",left:"72px"},o.a.createElement(c.B,{size:"medium",bgColor:"transparent"})),o.a.createElement(Ct,{width:"100%",height:"100%",borderRadius:"s",_css:w&&w.image?"url(".concat(w.image,")"):"none"})))),o.a.createElement(c.i,null,o.a.createElement(kt,{name:"title",id:"share-title",translate:"no",placeholder:"Title",maxLength:128,color:"white",textStyle:"small",mt:"4px",disabled:m(),defaultValue:w&&w.title?w.title:void 0,onBlur:C}),o.a.createElement(Tt,{name:"description",id:"share-description",translate:"no",maxLength:2048,autoSize:!0,color:"white",textStyle:"small",mt:"4px",disabled:m(),defaultValue:w&&w.description?w.description:void 0,onBlur:C})),o.a.createElement(c.i,{mt:"16px"},o.a.createElement(Nt,{htmlFor:"share-tweet",_css2:Object(h.themeGet)("colors.white"),_css3:Object(h.themeGet)("textStyles.small")},"Tweet message"),o.a.createElement(It,{name:"tweet",id:"share-tweet",translate:"no",maxLength:116,autoSize:!0,color:"white",textStyle:"small",disabled:m(),defaultValue:w&&w.tweet?w.tweet:void 0,onBlur:C})),o.a.createElement(c.r,{mt:"16px",alignItems:"center",justifyContent:"space-between"},o.a.createElement(c.i,{width:"128px"},o.a.createElement(At,{htmlFor:"all-pages",_css4:Object(h.themeGet)("colors.white"),_css5:Object(h.themeGet)("textStyles.small")},"Use these sharing settings for all pages")),o.a.createElement(c.V,{id:"all-pages",name:"all-pages",disabled:m()||!(!l||k()),checked:k(),onChange:function(e){t&&(e?(u(t._id),n.projectSave({master_share_pid:t._id})):(u(null),n.projectUnset("master_share_pid"),n.projectSave({})))}})),o.a.createElement(Et,{textStyle:"small",color:"white",mt:"16px",display:g===Pt.Default?"block":"none",onClick:function(e){e.preventDefault(),t&&(i?(g!==Pt.Inherited&&f(Pt.Custom),S()):r.render())}},"Customize"),o.a.createElement(Et,{textStyle:"small",color:"white",mt:"16px",display:g===Pt.Custom?"block":"none",onClick:function(e){if(e.preventDefault(),t){n.pageUnset(t._id,"custom_shares");var r=n.pageSave(t._id,{});l&&(n.projectUnset("master_share_pid"),n.projectSave({}),u(null)),!r||r instanceof Error||r.done((function(e){O(y(e)),f(d(e))})).fail((function(){}))}}},"Restore to defaults"),o.a.createElement(Et,{textStyle:"small",color:"white",mt:"16px",display:g===Pt.Inherited?"block":"none",onClick:function(e){e.preventDefault(),l&&window.RM.constructorRouter.showWorkspace({id:l})}},"Go to master page"))})),Bt=n("EcEN");function Rt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function zt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Rt(n,!0).forEach((function(t){Mt(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Rt(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Mt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Lt(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var n=[],r=!0,a=!1,o=void 0;try{for(var i,s=e[Symbol.iterator]();!(r=(i=s.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){a=!0,o=e}finally{try{r||null==s.return||s.return()}finally{if(a)throw o}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var Ft=b.d.button.withConfig({displayName:"Accordion__CollapseButton"})(["width:100%;box-sizing:border-box;padding:11px 0;border:0;outline:0;background:transparent;text-align:left;transition:color 200ms,border 200ms;"]),Gt=Object(b.d)(c.i).withConfig({displayName:"Accordion___StyledBox"})(["height:",";overflow:hidden;transition:height 300ms ease;"],(function(e){return e._css})),Wt=function(e){var t=e.title,n=e.open,r=e.customClass,i=e.activeKey,s=e.containerHeight,l=e.count,u=e.onCollapseClick,d=e.children,p=Lt(Object(a.useState)(0),2),g=p[0],f=p[1],m=Lt(Object(a.useState)(0),2),h=m[0],b=m[1],y=Lt(Object(a.useState)(Object(Bt.v4)()),1)[0],v=Object(a.useCallback)((function(e){null!==e&&f(e.getBoundingClientRect().height)}),[]);Object(a.useEffect)((function(){s&&l&&b(s-l*g)}),[s]);var j,w=function(){return null===i&&n||i===y};return o.a.createElement(o.a.Fragment,null,o.a.createElement(Ft,{className:(j="collapse-btn "+(w()?"active":"inactive"),r&&(j+=" ".concat(r)),j),ref:v,onClick:function(){return u&&u(y)}},o.a.createElement(c.W,{textStyle:"subheading"},t)),o.a.createElement(Gt,{_css:w()?Number(h)+"px":"0px"},d))},Ut=function(e){var t=e.children,n=Lt(Object(a.useState)({containerHeight:0,count:o.a.Children.count(t),activeKey:null}),2),r=n[0],i=n[1],s=Object(a.useCallback)((function(e){null!==e&&i(zt({},r,{containerHeight:e.getBoundingClientRect().height}))}),[]),l=function(e){i(zt({},r,{activeKey:e}))};return o.a.createElement(c.i,{width:"100%",height:"100%",ref:s},o.a.Children.map(t,(function(e){if(o.a.isValidElement(e)&&e.type===Wt)return o.a.cloneElement(e,zt({},r,{onCollapseClick:l}));throw new Error("Only Collapse elements can be children of Accordion")})))};function Yt(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var n=[],r=!0,a=!1,o=void 0;try{for(var i,s=e[Symbol.iterator]();!(r=(i=s.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){a=!0,o=e}finally{try{r||null==s.return||s.return()}finally{if(a)throw o}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var Vt=b.d.div.withConfig({displayName:"PageSettings__PageSettingsSidebar"})(["height:100%;width:240px;padding:0;box-sizing:border-box;position:fixed;top:0;right:0;bottom:0;z-index:",";background-color:",";overflow-x:hidden;overflow-y:auto;transform:translateX( "," );transition:transform 300ms ease;.collapse-btn.active{color:",";}.collapse-btn.inactive{color:",";}.collapse-btn.devider{border-top:2px solid ",";}"],I,Object(h.themeGet)("colors.black"),(function(e){return e.isSettingsOpened?e.isPageSettingsOpened?"0":"240px":e.isPageSettingsOpened?"480px":"240px"}),Object(h.themeGet)("colors.white"),Object(h.themeGet)("colors.darkGray"),Object(h.themeGet)("colors.darkGray")),Xt=function(){var e=Object(a.useContext)(g),t=Object(a.useContext)(dn),n=Yt(Object(a.useState)(null),2),r=n[0],i=n[1];return Object(a.useEffect)((function(){var n=e.isPageSettingsOpened&&t.pages.find((function(e){return e.num===t.currentPageNum}))||null;return i(n),function(){i(null)}}),[e.isPageSettingsOpened,t.currentPageNum]),Object(a.useEffect)((function(){e.isPageSettingsOpened?document.body.classList.add("page-settings-is-opened"):document.body.classList.remove("page-settings-is-opened")}),[e.isPageSettingsOpened]),o.a.createElement(Vt,{isPageSettingsOpened:e.isPageSettingsOpened,isSettingsOpened:e.isSettingsOpened},o.a.createElement(c.i,{height:"100%",mx:"24px"},o.a.createElement(Ut,null,o.a.createElement(Wt,{title:"Page SEO",open:!0},o.a.createElement(bt,{currentPage:r})),o.a.createElement(Wt,{title:"Social sharing",customClass:"devider"},o.a.createElement(Dt,{currentPage:r})))))};function Jt(){var e=function(e,t){t||(t=e.slice(0));return Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}(["\n  display: block;\n  ",";\n"]);return Jt=function(){return e},e}function Ht(){return(Ht=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}var Qt=o.a.createElement("path",{d:"M17.485.515a1 1 0 010 1.414L10.415 9l7.07 7.071a1 1 0 01-1.414 1.414L9 10.415l-7.071 7.07a1 1 0 01-1.414-1.414L7.585 9 .516 1.929A1 1 0 011.929.515L9 7.585l7.071-7.07a1 1 0 011.414 0z",fill:"#FFF",fillRule:"evenodd"}),Zt=Object(b.d)((function(e){return o.a.createElement("svg",Ht({width:18,height:18},e),Qt)}))(Jt(),h.color),qt=Object(b.d)(c.i).withConfig({displayName:"Settings__SettingsSidebar"})(["font-family:",";transform:translateX( "," );transition:transform 300ms ease;"],Object(h.themeGet)("fonts.main"),(function(e){return e.isSettingsOpened?e.isTrashOpened||e.isPageSettingsOpened?"-240px":"0px":"240px"}));qt.defaultProps={blacklist:["isSettingsOpened","isTrashOpened","isPageSettingsOpened","height","position","top","right","zIndex"]};var Kt=Object(b.d)(c.i).withConfig({displayName:"Settings__PreviewButtonWrap"})(["width:56px;height:56px;position:fixed;right:80px;bottom:16px;color:",";background-color:",";z-index:",";cursor:pointer;:hover{background-color:",";}transform:translateX( "," );transition:transform 300ms ease,background-color 200ms ease;"],Object(h.themeGet)("colors.white"),Object(h.themeGet)("colors.darkGray"),I,Object(h.themeGet)("colors.black"),(function(e){return e.isSettingsOpened?e.isTrashOpened||e.isPageSettingsOpened?"-480px":"-240px":"0px"}));Kt.defaultProps={blacklist:["isSettingsOpened","isTrashOpened","isPageSettingsOpened","borderRadius"]};var $t=Object(b.d)(c.r).withConfig({displayName:"Settings__SettingsToogleWrap"})(["width:56px;height:56px;position:fixed;right:16px;bottom:16px;justify-content:center;color:",";background-color:",";text-align:center;z-index:",";cursor:pointer;:hover{background-color:",";}transform:translateX( "," );transition:transform 300ms ease,background-color 200ms ease;"],Object(h.themeGet)("colors.white"),Object(h.themeGet)("colors.darkGray"),I,Object(h.themeGet)("colors.black"),(function(e){return e.isSettingsOpened?e.isTrashOpened||e.isPageSettingsOpened?"-480px":"-240px":"0px"}));$t.defaultProps={blacklist:["isSettingsOpened","isTrashOpened","isPageSettingsOpened","borderRadius"]};var en,tn=function(){var e=Object(a.useContext)(g);return o.a.createElement(Kt,{borderRadius:"round",isSettingsOpened:e.isSettingsOpened,isTrashOpened:e.isTrashOpened,isPageSettingsOpened:e.isPageSettingsOpened,onClick:function(){return window.RM.views.toolbar.togglePreview()}},o.a.createElement(c.r,{width:"56px",height:"56px",borderRadius:"round",justifyContent:"center",alignItems:"center"},o.a.createElement(c.p,{height:"26px",width:"38px",color:"white"})))},nn=function(){var e=Object(a.useContext)(g),t=Object(a.useContext)(dn);return o.a.createElement($t,{borderRadius:"round",isSettingsOpened:e.isSettingsOpened,isTrashOpened:e.isTrashOpened,isPageSettingsOpened:e.isPageSettingsOpened,onClick:function(){return e.dispatch({type:r.ToggleSettingsSidebar})}},e.isSettingsOpened?o.a.createElement(c.i,{mt:"19px"},o.a.createElement(Zt,null)):o.a.createElement(c.W,{textStyle:"subheading",lineHeight:"56px"},t.currentPageNum))},rn=Object(b.d)(c.i).withConfig({displayName:"Settings___StyledBox"})(["opacity:",";display:",";transition:opacity 300ms ease;"],(function(e){return e._css}),(function(e){return e._css2})),an=function(e){var t=e.projectSettingsPanel,n=Object(a.useContext)(g);return Object(a.useEffect)((function(){n.isSettingsOpened?document.body.classList.add("settings-is-shown"):document.body.classList.remove("settings-is-shown")}),[n.isSettingsOpened]),o.a.createElement(o.a.Fragment,null,o.a.createElement(tn,null),o.a.createElement(nn,null),o.a.createElement(qt,{isSettingsOpened:n.isSettingsOpened,isTrashOpened:n.isTrashOpened,isPageSettingsOpened:n.isPageSettingsOpened,width:"240px",height:"100%",position:"fixed",top:"0",right:"0",bottom:"0",zIndex:I},o.a.createElement(c.i,{width:"240px",height:"100%",p:2,bg:"lightGray",color:"black"},o.a.createElement(c.i,{id:"page-drag-container",position:"absolute",top:"0",left:"0",width:"100%"}),o.a.createElement(E,{projectSettingsPanel:t}),o.a.createElement(Oe,null),o.a.createElement(He,null)),o.a.createElement(rn,{width:"240px",height:"100%",position:"absolute",top:"0",bottom:"0",bg:"white",_css:n.isPageSettingsOpened?"0.6":"0",_css2:n.isPageSettingsOpened?"block":"none"})),o.a.createElement(st,null),o.a.createElement(Xt,null))};function on(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function sn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function cn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?sn(n,!0).forEach((function(t){ln(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):sn(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function ln(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function un(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var n=[],r=!0,a=!1,o=void 0;try{for(var i,s=e[Symbol.iterator]();!(r=(i=s.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){a=!0,o=e}finally{try{r||null==s.return||s.return()}finally{if(a)throw o}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}!function(e){e.After="after",e.Before="before",e.Inside="inside",e.AfterOutside="afteroutside"}(en||(en={}));var dn=o.a.createContext({}),pn=function e(t,n){var r=[];for(var a in t)if(t[a].parentPage===n){var o=e(t,t[a]._id),i=Object.assign({},t[a]);o.length&&(i.children=o),r.push(i)}else if(void 0===t[a].parentPage){var s=Object.assign({},t[a]);r.push(s)}return r},gn=function(e,t){var n={};return e.forEach((function(e){n[e._id]={collapsed:!0,children:e.children?e.children.map((function(e){return e._id})):[]}})),Object.keys(t).forEach((function(e){n[e]&&(n[e].collapsed=t[e].collapsed)})),n},fn=function(e){var t=e.project,n=e.router,r=e.children,i=un(Object(a.useState)(null),2),s=i[0],c=i[1];Object(a.useEffect)((function(){var e=document.querySelector(".settings-container");e&&c(e);var t=document.getElementById("page-list-container"),n=document.getElementById("project-settings-body"),r=document.getElementById("page-drag-container");t&&b((function(e){return cn({},e,{pagesListContainer:t,settingsBody:n,dragContainer:r})}))}),[]);var l=new Je.default({$parent:document.querySelector("body > .popups"),router:n,opts:{type:"type-more-pages",is_contributor:!n.isOwner,owner_email:t.get("user")?t.get("user").email:""},alert_source:"custom sharing"}),u={projectSet:function(e,n){return t.set(e,n)},projectUnset:function(e,n){return t.unset(e,n)},projectSave:function(e,n){return t.save(e,n)},pageSet:function(e,n,r){var a=t.pages.get(e);if(!a)throw new Error("Element not found");return a.set(n,r)},pageUnset:function(e,n,r){var a=t.pages.get(e);if(!a)throw new Error("Element not found");return a.unset(n,r)},pageSave:function(e,n,r){var a=t.pages.get(e);if(!a)throw new Error("Element not found");return a.save(n,r)},setCurrentPageNum:function(e){b((function(t){return cn({},t,{currentPageNum:e})}))},setPageCollapse:function(e,t){b((function(n){return cn({},n,{pagesParams:cn({},n.pagesParams,{},ln({},e,cn({},n.pagesParams[e],{collapsed:t})))})}))},addNewPage:function(e,r,a){return new Promise((function(o,i){var s=m(e,h.pages,h.pagesTree,h.pagesParams),c=s.newPageNum,l=s.newPageParentId,u={num:c};r&&(u=cn({},u,{},r)),t.addPage(u,(function(e){if(e&&e.err)i(e);else{var s=e;r||(s.isEmptyPage=!0),s.set("parentPage",l),n.pageOrder.reorderPagesAfterAdd({page:s,magId:t.get("_id")}),t.onAdd(s),a||n.showWorkspace({id:s.id}),t.getPage(s.id).requestNewScreenshot((function(){n.trigger("renewScreenshot",s.id)})),a||p(s.id),o(s)}}),!0)}))},duplicatePage:function(e){return new Promise((function(r,a){var o=t.getPage(e);if(!o)return a(new Error("Could not find page"));o.get("mid")||o.save({mid:t.get("_id")},{silent:!0});var i=m(o.get("num"),h.pages,h.pagesTree,h.pagesParams),s=i.newPageNum,c=i.newPageParentId;o.duplicate((function(e){if(e instanceof Error)return"Server error: permission_denied"===e.message&&l.render(),a(e);var o=e;o.set("parentPage",c),n.pageOrder.reorderPagesAfterAdd({page:o,magId:t.get("_id")}),t.onAdd(o),n.gg.guides.model&&(n.gg.guides.model.addPage(o.id,{silent:n.gg.guides.hidden}),n.gg.guides.model.save()),n.showWorkspace({id:o.id}),p(o.id),r(e)}),{num:s})}))},getNewPageOrderElement:function(e){var n=e.changingId,r=e.targetId,a=e.position,o=t.getPage(r),i=h.pagesParams[r],s={id:n,num:1,parentPage:null};if(a===en.Inside){if(!i)return new Error("insert into child element");s.num=o.get("num")+1,s.parentPage=r}else if(a===en.Before)s.parentPage=i?null:o.get("parentPage")||null,s.num=o.get("num");else if(a===en.AfterOutside){if(i)return new Error("insert after outside parent element");var c=h.pagesParams[o.get("parentPage")];if(!c||!c.children)return new Error("can not find parent page for target page");if(c.children.indexOf(r)!==c.children.length-1)return new Error("insert after outside not last child page");s.num=o.get("num")+1}else i&&i.children.length?i.collapsed?(s.num=o.get("num")+1,s.parentPage=r):(s.num=o.get("num")+i.children.length+1,s.parentPage=null):(s.parentPage=i?null:o.get("parentPage")||null,s.num=o.get("num")+1);return s},reorderPage:function(e,r){return new Promise((function(a,o){var i=t.getPage(e);if(i.get("num")===r.num&&i.get("parentPage")===r.parentPage)return a();var s=h.pagesParams[e],c=0;s&&s.children.length&&(c=s&&s.children.length),c&&(s.collapsed?n.pageOrder.removeParentIds(s.children):r.parentPage&&n.pageOrder.updateParentIds(s.children,r.parentPage)),n.pageOrder.reorderAfterDrag(i.get("num"),c,r,t.get("_id"));var l=n.workspace.getPageNum();l!==h.currentPageNum&&n.showWorkspace({num:l}),t.trigger("change:pids",t,t.get("pids")),a()}))},deletePage:function(e){return new Promise((function(r,a){if(n.isPageLocked(e))return a(new Error("This page is locked"));if(1===t.get("pids").length)return a(new Error("Can't delete last page"));var o=t.getPage(e),i=o.get("num"),s=n.workspace.getPageNum()===i,c=h.pagesParams[e],l=[];if(c){var u=h.pagesTree.find((function(t){return t._id===e})),p=[];u&&u.children&&u.children.length&&(p=u.children.map((function(e){return e._id}))),c.collapsed?n.pageOrder.removeParentIds(p):l=on(p)}l.push(o.get("_id")),n.pageOrder.deletePagesFromOrder(l,t.get("_id")),t.deletePages(l,(function(e){e&&e instanceof Error&&(n.pageOrder.load(t),a(e)),s&&d(i),n.removeWorkspace(o.id),r()}))}))},restorePage:function(e){return new Promise((function(r,a){t.restorePage(e,{success:function(e){var a=m(n.workspace.getPageNum(),h.pages,h.pagesTree,h.pagesParams),o=a.newPageNum,i=a.newPageParentId;e.set("num",o),e.set("parentPage",i),n.pageOrder.reorderPagesAfterAdd({page:e,magId:t.get("_id")}),t.onAdd(e),t.save(),n.showWorkspace({id:e.id}),p(e.id),r(e)},error:function(e){var t=JSON.parse(e.responseText);"permission_denied"===t.err&&l.render(),a(t)}},!0)}))},deletePagesFromTrash:function(e){return t.deleteTrashPages(e)},updateTrash:function(){return new Promise((function(e,n){t.get("has_deleted_pages")?t.fetchTrashPages().then((function(t){t&&b((function(e){return cn({},e,{trashPages:t})})),e(t)})):e([])}))},emptyTrash:function(){return t.emptyTrash().then((function(){b((function(e){return cn({},e,{trashPages:[]})}))}))},getUserTemplates:function(){return t.loadUserTemplates().then((function(e){return Array.isArray(e)&&b((function(t){return cn({},t,{userTemplates:e})})),e}))},createTemplateFromCurrentPage:function(){return n.createTemplateFromCurrentPage().then((function(e){return e&&b((function(t){var n=Array.from(t.userTemplates);return n.unshift(e),cn({},t,{userTemplates:n})})),e})).catch((function(e){throw e&&"permission denied"===e.message&&l.render(),e}))},deleteUserTemplate:function(e){return Object(yt.c)(e).then((function(){b((function(t){return cn({},t,{userTemplates:t.userTemplates.filter((function(t){return t.id!==e}))})}))}))},getPageAlert:function(){return l}},d=function(e){var t=n.pageOrder.get("order"),r=null;if(e>t.length)r=t[t.length-1].id;else{var a=t.find((function(t){return t.num===e}));a&&(r=a.id)}r?(n.showWorkspace({id:r}),p(r)):n.showWorkspace({num:1})},p=function(e){if(s){var t=s.querySelector('.page-list-draggable-item[data-page-id="'.concat(e,'"]'));t&&t.scrollIntoView({behavior:"smooth"})}},g=function(e){var t=cn({},e.attributes);return delete t.children,t},f=un(Object(a.useState)((function(){var e=t.pages.models.map((function(e){return g(e)}));e.sort((function(e,t){return e.num-t.num}));var r=pn(e,null);return{project:t.attributes,isOwner:!!n.isOwner,pages:e,trashPages:[],userTemplates:[],currentPageNum:n.workspace.getPageNum(),pagesTree:r,pagesParams:gn(r,{}),pagesListContainer:null,settingsBody:null,dragContainer:null}})),2),h=f[0],b=f[1],y=function(e,t){e&&b((function(n){var r=e.pages.models.map((function(e){return g(e)})).filter((function(e){return t.includes(e._id)}));r.sort((function(e,t){return e.num-t.num}));var a=pn(r,null);return cn({},n,{project:e.attributes,pages:r,pagesTree:a,pagesParams:gn(a,n.pagesParams)})}))},v=function(e){e&&(e.changed&&e.changed.pids||b((function(t){return cn({},t,{project:e.attributes})})))},j=function(e){e&&(e.changed&&(e.changed.num||e.changed.parentPage)||b((function(t){var n=w(e,t.pages);n.sort((function(e,t){return e.num-t.num}));var r=pn(n,null);return cn({},t,{pages:n,pagesTree:r,pagesParams:gn(r,t.pagesParams)})})))},w=function(e,t){var n=h.pages.findIndex((function(t){return t._id===e.get("_id")}));return n>=0?h.pages.map((function(t,r){return r===n?g(e):t})).sort((function(e,t){return e.num-t.num})):t},O=function(e){e&&b((function(t){var n=Array.from(t.trashPages);return n.push(e.attributes),cn({},t,{trashPages:n})}))},S=function(e){e&&b((function(t){var n=Array.from(t.trashPages),r=n.findIndex((function(t){return t._id===e.get("_id")}));return r>-1&&n.splice(r,1),cn({},t,{trashPages:n})}))};Object(a.useEffect)((function(){return t.on("change",v),t.on("change:pids",y),t.pages.on("change",j),t.trashPages.on("add",O),t.trashPages.on("remove",S),function(){t.off("change",v),t.off("change:pids",y),t.pages.off("change",j),t.trashPages.off("add",O),t.trashPages.off("remove",S)}}),[t]);var x=function(e){u.setCurrentPageNum(e.getPageNum())};return Object(a.useEffect)((function(){return n.on("pageChange",x),function(){n.off("pageChange",x)}}),[n]),o.a.createElement(dn.Provider,{value:cn({},h,{},u)},r)},mn=function(e){var t=e.model,n=e.router,r=e.children;return o.a.createElement(fn,{project:t,router:n},o.a.createElement(f,{magModel:t,router:n},r))},hn=function(e){var t=e.model,n=e.domElement,r=e.router,a=e.projectSettingsPanel;s.a.render(o.a.createElement(c.X,null,o.a.createElement(mn,{model:t,router:r},o.a.createElement(an,{projectSettingsPanel:a}))),n)};n.d(t,"ReorderPagePosition",(function(){return en})),n.d(t,"ProjectContext",(function(){return dn})),n.d(t,"ProjectContextProvider",(function(){return fn})),n.d(t,"SettingsController",(function(){return mn})),n.d(t,"renderSettings",(function(){return hn})),n.d(t,"SettingsActionTypes",(function(){return r})),n.d(t,"SettingsContext",(function(){return g})),n.d(t,"CreateSettingsContextProvider",(function(){return f}))}}]);